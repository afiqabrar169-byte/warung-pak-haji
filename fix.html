<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Warung Pak Haji - Mobile</title>
    <style>
        * { box-sizing: border-box; transition: all 0.3s; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; height: 100vh; overflow: hidden; }

        /* LOGIN PAGE */
        #login-page { position: fixed; inset: 0; background: #1b5e20; display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .login-card { background: white; padding: 30px; border-radius: 15px; width: 100%; max-width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }

        /* LAYOUT UTAMA */
        #main-layout { display: none; height: 100vh; width: 100%; flex-direction: column; }
        #sidebar { 
            width: 100%; height: 70px; background: #1b5e20; color: white; 
            display: flex; flex-direction: row; justify-content: space-around; 
            align-items: center; position: fixed; bottom: 0; z-index: 1000;
        }
        .menu-item { padding: 10px; cursor: pointer; border-radius: 8px; color: white; text-align: center; font-size: 0.75rem; flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; border: none; background: transparent; }
        .menu-item:hover, .active { background: #2e7d32; font-weight: bold; }

        /* KONTEN */
        #main-content { flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 85px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .grid { display: flex; flex-direction: column; gap: 15px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .input-field { padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 100%; margin-bottom: 10px; font-size: 16px; }
        
        .btn { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #2e7d32; color: white; width: 100%; }
        .btn-blue { background: #1565c0; color: white; }
        .btn-red { background: #c62828; color: white; }
        
        .page { display: none; }
        .active-page { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #notif-container { position: fixed; top: 10px; left: 10px; right: 10px; z-index: 2000; display: flex; flex-direction: column; gap: 8px; }
        .notif-item { background: #fff3e0; border-left: 5px solid #ff9800; padding: 12px; border-radius: 8px; font-size: 0.8rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .admin-only { display: none; }
    </style>
</head>
<body>

<div id="notif-container"></div>

<div id="login-page">
  <div class="login-card">
    <h2 style="color: #1b5e20;">WARUNG PAK HAJI</h2>
    <input type="text" id="user" class="input-field" placeholder="Username (admin/kasir)">
    <input type="password" id="pass" class="input-field" placeholder="Password (123)">
    <button class="btn btn-green" onclick="login()">MASUK</button>
  </div>
</div>

<div id="main-layout">
  <div id="main-content">
    
    <div id="dashboard" class="page active-page">
      <h2>Halo, <span id="welcome-role"></span>!</h2>
      <div class="grid">
        <div class="card" style="border-left: 5px solid green;">
            <small>Pendapatan Hari Ini</small>
            <h3 style="margin:5px 0">Rp 1.450.000</h3>
        </div>
        <div class="card" style="border-left: 5px solid red;">
            <small>Peringatan Stok</small>
            <h3 id="dash-kritis" style="margin:5px 0; color:red;">0 Item Menipis</h3>
        </div>
      </div>
    </div>

    <div id="transaksi" class="page">
      <h2>Kasir</h2>
      <input type="text" id="src" class="input-field" placeholder="Cari nama barang...">
      <div id="res" class="card" style="display:none; position:absolute; width:90%; z-index:10; border: 2px solid #2e7d32;"></div>
      <div class="card">
        <table id="cart">
          <thead><tr><th>Item</th><th>Qty</th><th>Total</th></tr></thead>
          <tbody></tbody>
        </table>
        <h2 id="tagihan" style="text-align:right; color:green;">Rp 0</h2>
        <button class="btn btn-green" onclick="bayar()">KONFIRMASI BAYAR</button>
      </div>
    </div>

    <div id="stok" class="page">
      <h2>Manajemen Stok</h2>
      <div class="card admin-only" id="form-stok">
        <h4 id="form-title" style="margin-top:0">Tambah Barang</h4>
        <input type="hidden" id="edit-id">
        <input type="text" id="st-nama" class="input-field" placeholder="Nama Barang">
        <input type="number" id="st-harga" class="input-field" placeholder="Harga">
        <input type="number" id="st-stok" class="input-field" placeholder="Stok">
        <div style="display:flex; gap:10px">
            <button id="btn-save" class="btn btn-blue" style="flex:2" onclick="simpanBarang()">Simpan</button>
            <button id="btn-cancel" class="btn btn-red" style="flex:1; display:none" onclick="resetForm()">Batal</button>
        </div>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>Barang</th><th>Stok</th><th class="admin-only">Aksi</th></tr></thead>
          <tbody id="list-stok"></tbody>
        </table>
      </div>
    </div>

  </div>

  <div id="sidebar">
    <div class="menu-item active" onclick="showPage('dashboard', this)"><span>üìä</span>Dash</div>
    <div class="menu-item" onclick="showPage('transaksi', this)"><span>üõí</span>Kasir</div>
    <div class="menu-item" onclick="showPage('stok', this)"><span>üì¶</span>Stok</div>
    <div class="menu-item" style="color:#ff8a80" onclick="logout()"><span>üö™</span>Out</div>
  </div>
</div>

<script>
  let db = [
    { id: 1, nama: "Beras 5kg", harga: 65000, stok: 10 },
    { id: 2, nama: "Minyak 1L", harga: 15000, stok: 3 }
  ];
  let keranjang = [];
  let currentRole = "";

  function buatNotifikasi(nama, sisa) {
    const container = document.getElementById('notif-container');
    const div = document.createElement('div');
    div.className = "notif-item";
    div.innerHTML = `‚ö†Ô∏è <b>Restock: ${nama}</b> sisa ${sisa}`;
    container.appendChild(div);
    setTimeout(() => { div.style.opacity = '0'; setTimeout(() => div.remove(), 300); }, 3000);
  }

  function login() {
    const u = document.getElementById('user').value.toLowerCase();
    const p = document.getElementById('pass').value;
    if((u === "admin" || u === "kasir") && p === "123") {
      currentRole = u.toUpperCase();
      document.getElementById('login-page').style.display = "none";
      document.getElementById('main-layout').style.display = "flex";
      document.getElementById('welcome-role').innerText = currentRole;
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = (currentRole === "ADMIN") ? "block" : "none");
      renderStok();
    } else { alert("Login Gagal!"); }
  }

  function logout() { if(confirm("Keluar?")) location.reload(); }

  function showPage(id, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
    document.getElementById(id).classList.add('active-page');
    document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
    el.classList.add('active');
  }

  function renderStok() {
    const tbody = document.getElementById('list-stok');
    tbody.innerHTML = "";
    let k = 0;
    db.forEach(i => {
      if(i.stok < 5) { k++; buatNotifikasi(i.nama, i.stok); }
      let aksi = (currentRole === "ADMIN") ? 
        `<td>
            <button class="btn btn-blue" style="padding:5px" onclick="prepareEdit(${i.id})">Edit</button>
            <button class="btn btn-red" style="padding:5px" onclick="hapusBarang(${i.id})">X</button>
         </td>` : "";
      const style = i.stok < 5 ? 'style="color:red; font-weight:bold"' : '';
      tbody.innerHTML += `<tr ${style}><td>${i.nama}<br><small>Rp ${i.harga}</small></td><td>${i.stok}</td>${aksi}</tr>`;
    });
    document.getElementById('dash-kritis').innerText = k + " Item Menipis";
  }

  // --- LOGIKA EDIT & SIMPAN ---
  function prepareEdit(id) {
    let item = db.find(x => x.id == id);
    if(item) {
      document.getElementById('edit-id').value = item.id;
      document.getElementById('st-nama').value = item.nama;
      document.getElementById('st-harga').value = item.harga;
      document.getElementById('st-stok').value = item.stok;
      document.getElementById('form-title').innerText = "Edit Barang";
      document.getElementById('btn-save').innerText = "Update";
      document.getElementById('btn-cancel').style.display = "block";
      window.scrollTo(0,0);
    }
  }

  function simpanBarang() {
    const id = document.getElementById('edit-id').value;
    const n = document.getElementById('st-nama').value;
    const h = parseInt(document.getElementById('st-harga').value);
    const s = parseInt(document.getElementById('st-stok').value);

    if(!n || isNaN(h)) return alert("Isi data!");

    if(id) {
      let index = db.findIndex(x => x.id == id);
      db[index] = { id: parseInt(id), nama: n, harga: h, stok: s };
    } else {
      db.push({ id: Date.now(), nama: n, harga: h, stok: s });
    }
    resetForm(); renderStok();
  }

  function resetForm() {
    document.getElementById('edit-id').value = "";
    document.getElementById('st-nama').value = "";
    document.getElementById('st-harga').value = "";
    document.getElementById('st-stok').value = "";
    document.getElementById('form-title').innerText = "Tambah Barang";
    document.getElementById('btn-save').innerText = "Simpan";
    document.getElementById('btn-cancel').style.display = "none";
  }

  function hapusBarang(id) {
    if(confirm("Hapus barang?")) {
      db = db.filter(x => x.id != id);
      renderStok();
    }
  }

  // KASIR LOGIC
  document.getElementById('src').onkeyup = function() {
    const k = this.value.toLowerCase();
    const r = document.getElementById('res');
    if(!k) { r.style.display="none"; return; }
    r.innerHTML = ""; r.style.display="block";
    db.filter(x => x.nama.toLowerCase().includes(k)).forEach(x => {
      let d = document.createElement('div');
      d.style.padding="10px"; d.innerText = x.nama;
      d.onclick = () => {
        let ada = keranjang.find(c => c.id == x.id);
        if(ada) ada.qty++; else keranjang.push({...x, qty:1});
        r.style.display="none"; document.getElementById('src').value=""; renderCart();
      };
      r.appendChild(d);
    });
  };

  function renderCart() {
    const tb = document.querySelector('#cart tbody');
    tb.innerHTML = ""; let t = 0;
    keranjang.forEach(c => {
      let sub = c.harga * c.qty; t += sub;
      tb.innerHTML += `<tr><td>${c.nama}</td><td>${c.qty}</td><td>${sub}</td></tr>`;
    });
    document.getElementById('tagihan').innerText = "Rp " + t.toLocaleString();
  }

  function bayar() {
    if(keranjang.length == 0) return;
    keranjang.forEach(c => {
      let i = db.find(x => x.id == c.id);
      if(i) i.stok -= c.qty;
    });
    alert("Berhasil!"); keranjang = []; renderCart(); renderStok();
  }
</script>
</body>
</html>